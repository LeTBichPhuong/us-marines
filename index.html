<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>In tên trên áo</title>
    <style>
        body {
            background: #777;
            display: flex;
            justify-content: center;
            padding: 40px;
            font-family: Arial, sans-serif;
        }

        .product-preview {
            position: relative;
            width: 600px;
        }

        .product-preview img {
            width: 100%;
            display: block;
        }

        /* Lớp in chữ */
        .print-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
    </style>
</head>
<body>

<div class="product-preview">
    <!-- Ảnh áo -->
    <img src="us-marines.jpg" alt="Áo">

    <!-- SVG in chữ -->
    <svg class="print-layer" viewBox="0 0 1024 1024">

        <!-- Patch nền -->
        <rect
            id="nameBg"
            x="127"
            y="519"
            rx="3"
            ry="3"
            width="140"
            fill="#565559"
            stroke="#dec27a"
            stroke-width="1"
        />

        <!-- Chữ -->
        <text
            id="printName"
            x="145"
            y="539"
            fill="#dec27a"
            font-size="16"
            font-weight="600"
            letter-spacing="0.3"
        >
        </text>

    </svg>
</div>

<script>
const params = new URLSearchParams(window.location.search);
const name = params.get('name');

const text = document.getElementById('printName');
const bg = document.getElementById('nameBg');

const SHORT_LIMIT = 14;

const paddingX = 6;
const paddingY = 4;

const baseFontSize = 16;
const minFontSize = 10;
const maxPatchWidth = 160;

if (!name) {
    bg.style.display = 'none';
} else {
    text.textContent = name.toUpperCase();
    text.setAttribute('font-size', baseFontSize);

    requestAnimationFrame(() => {

        if (name.length <= SHORT_LIMIT) {
            // đo kích thước path theo text
            text.setAttribute('text-anchor', 'start');
            const box = text.getBBox();
            const patchWidth = box.width + paddingX * 2;
            const patchHeight = box.height + paddingY * 2;
            
            bg.setAttribute('width', patchWidth);
            bg.setAttribute('height', patchHeight);
            
            // Căn giữa text trong patch: vị trí patch + nửa chiều rộng patch
            const centerX = 127 + patchWidth / 2;
            text.setAttribute('x', centerX);
            text.setAttribute('text-anchor', 'middle');
            
            return;
        }

        // Vị trí chữ và patch trên 13 ký tự
        bg.setAttribute('x', 84);
        bg.setAttribute('y', 524);

        text.setAttribute('x', 90);
        text.setAttribute('y', 538);

        let fontSize = baseFontSize;
        let box = text.getBBox();

        // Thu nhỏ chữ
        while (
            box.width + paddingX * 2 > maxPatchWidth &&
            fontSize > minFontSize
        ) {
            fontSize--;
            text.setAttribute('font-size', fontSize);
            box = text.getBBox();
        }

        // Patch ôm chữ CHUẨN
        bg.setAttribute('width', box.width + paddingX * 2);
        bg.setAttribute('height', box.height + paddingY * 2);
    });
}
</script>

</body>
</html>
